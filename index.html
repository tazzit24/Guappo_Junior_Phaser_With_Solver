<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="manifest" href="manifest.json">
    <meta charset="UTF-8" />
    <title>Guappo Junior 1</title>

    <script>
        (function() {
            function init() {
                const titleEl = document.querySelector('#initial-loader .title');
                
                const libs = [
                    'lib/phaser.min.js',
                    'lib/rexuiplugin.min.js'
                ];
                
                function loadScript(url) {
                    return new Promise((resolve, reject) => {
                        const xhr = new XMLHttpRequest();
                        xhr.open('GET', url, true);
                        xhr.responseType = 'blob';
                        
                        xhr.onload = (e) => {
                            if (xhr.status === 200) {
                                const url = URL.createObjectURL(xhr.response);
                                const script = document.createElement('script');
                                script.src = url;
                                script.onload = () => {
                                    URL.revokeObjectURL(url);
                                    resolve();
                                };
                                document.head.appendChild(script);
                            } else {
                                reject(xhr.statusText);
                            }
                        };
                        
                        xhr.onerror = () => reject('Network error');
                        xhr.send();
                    });
                }

                async function boot() {
                    try {
                        for (const lib of libs) {
                            await loadScript(lib);
                        }
                        
                        // Inject Main.js after libraries are ready
                        const mainScript = document.createElement('script');
                        mainScript.type = 'module';
                        mainScript.src = './src/Main.js';
                        document.body.appendChild(mainScript);
                        
                    } catch (err) {
                        console.error('Boot failed:', err);
                        if (titleEl) titleEl.textContent = 'Error loading game';
                    }
                }
                
                boot();
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>

    <style type="text/css">
        body {
            margin: 0;
            background-color: rgb(41, 38, 38);
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        #initial-loader {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgb(19 18 25 / 0.95);
            color: #ffffff;
            z-index: 9999;
            transition: opacity 250ms ease;
        }

        #initial-loader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #initial-loader .message {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        #initial-loader .message .title {
            font-size: clamp(1.1rem, 2vw, 1.6rem);
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: #b1c9ff;
        }

        #initial-loader .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(177, 201, 255, 0.2);
            border-top: 3px solid #b1c9ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body>
    <div id="initial-loader">
        <div class="message">
            <div class="title">Loading Guappo Juniorâ€¦</div>
            <div class="spinner"></div>
        </div>
    </div>
    <div id="phaser-game"></div>
</body>

</html>